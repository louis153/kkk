<?xml version="1.0" encoding="UTF-8"?>
   <!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
    <mapper namespace="com.tengcai.vims.entity.sporttery.USER_DAYWIN">
	<select id = "selectUSER_DAYWINList" resultType="USER_DAYWIN" parameterType="USER_DAYWIN">
		SELECT id,user_pin,win_fee,prize_cancel_time,prize_status from t_user_daywin
        <where>
<if test="id != null">
 and id=#{id}
</if>
<if test="user_pin != null">
 and user_pin = #{user_pin}
</if>
<if test="win_fee != null">
 and win_fee=#{win_fee}
</if>
<if test="prize_cancel_time != null">
 and prize_cancel_time=#{prize_cancel_time}
</if>
<if test="prize_status != null">
 and prize_status=#{prize_status}
</if>
</where>
order by id

        <if test = "row_start != null and page_size != null" >
        limit #{row_start},#{page_size}
        </if>
    </select>
    <select id = "selectUSER_DAYWINCount" resultType="int" parameterType="USER_DAYWIN">
		SELECT count(*) from t_user_daywin
        <where>
<if test="id != null">
 and id=#{id}
</if>
<if test="user_pin != null">
 and user_pin = #{user_pin}
</if>
<if test="win_fee != null">
 and win_fee=#{win_fee}
</if>
<if test="prize_cancel_time != null">
 and prize_cancel_time=#{prize_cancel_time}
</if>
<if test="prize_status != null">
 and prize_status=#{prize_status}
</if>
</where>
order by id
       
    </select>
    <insert id="save" parameterType="USER_DAYWIN">
    <![CDATA[
        INSERT INTO t_user_daywin(id,user_pin,win_fee,prize_cancel_time,prize_status)
VALUES(#{id},#{user_pin},#{win_fee},#{prize_cancel_time},#{prize_status})
	]]>
    </insert>
    <insert id="saveList" parameterType="java.util.List">
    <![CDATA[
        INSERT INTO t_user_daywin(id,user_pin,win_fee,prize_cancel_time,prize_status)
VALUES
	]]>
    <foreach collection="list" item="v" index="index" separator=", " > 
        <![CDATA[(#{v.id},#{v.user_pin},#{v.win_fee},#{v.prize_cancel_time},#{v.prize_status}) ]]>
    </foreach>
    </insert>
    
    <update id="update" parameterType="USER_DAYWIN">
    <![CDATA[
        UPDATE t_user_daywin set id=#{id},user_pin=#{user_pin},win_fee=#{win_fee},prize_cancel_time=#{prize_cancel_time},prize_status=#{prize_status}
		WHERE  id=#{id} 
	]]>
    </update>
    <insert id="updateList" parameterType="java.util.List">
    <![CDATA[
        REPLACE INTO t_user_daywin(id,user_pin,win_fee,prize_cancel_time,prize_status)
    VALUES
	]]>
    <foreach collection="list" item="v" index="index" separator=", " > 
        <![CDATA[(#{v.id},#{v.user_pin},#{v.win_fee},#{v.prize_cancel_time},#{v.prize_status}) ]]>
    </foreach>
    </insert>
    <delete id="delete" parameterType="USER_DAYWIN">
    <![CDATA[
        DELETE FROM t_user_daywin WHERE  id=#{id} 
	]]>
    </delete> 
    <insert id="teInsert">
	<![CDATA[
	insert into t_user_daywin (user_pin,win_fee,prize_cancel_time,prize_status)
select user_pin,sum(win_fee) as win_fee,date(min(prize_cancel_time)) prize_cancel_time,prize_status  from LOTO_ORDER
WHERE  prize_status=2 and bet_status=2 AND date(prize_cancel_time)=date(date_sub(now(),interval -1 day))
GROUP BY user_pin;
	]]>
	</insert>
    <delete id="teDelete">
    <![CDATA[
    DELETE from t_user_daywin WHERE date(prize_cancel_time) <date(date_sub(now(),interval -1 day))
    ]]>
    </delete>   
</mapper > 